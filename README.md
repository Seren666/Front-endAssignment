# CollaBoard

<div align="center">

**ğŸ–Œï¸ å¤šäººå®æ—¶åä½œç™½æ¿**

</div>

<div align="center">

![License](https://img.shields.io/badge/license-MIT-brightgreen)
![Node.js](https://img.shields.io/badge/Node.js-18.x-brightgreen)
![Vite](https://img.shields.io/badge/Vite-7.2.6-blue)
![React](https://img.shields.io/badge/React-18.x-blue)

</div>

æ”¯æŒ**è‡ªç”±ç»˜åˆ¶ã€å›¾å½¢ç»˜åˆ¶ã€æ’¤é”€/é‡åšã€å¤šäººå…‰æ ‡**å’Œ**å¯¼å‡ºå›¾ç‰‡**ç­‰åŠŸèƒ½ã€‚

---

## ç›®å½•

- [CollaBoard](#Collaboard)

  - [ç›®å½•](#ç›®å½•)
  - [ğŸš€ä¸»è¦åŠŸèƒ½](#ğŸš€ä¸»è¦åŠŸèƒ½)
  - [ğŸ§ æ ¸å¿ƒåŸç†](#ğŸ§ æ ¸å¿ƒåŸç†)

    - [æ¦‚è¿°](#æ¦‚è¿°)
    - [åè®®ä¸äº‹ä»¶å®šä¹‰](#åè®®ä¸äº‹ä»¶å®šä¹‰ï¼ˆSocketï¼‰)
    - [ğŸ’¡å¼€å‘æç¤º](#ğŸ’¡å¼€å‘æç¤º)
  - [âš¡å¿«é€Ÿå¼€å§‹](#âš¡å¿«é€Ÿå¼€å§‹)

    - [å®‰è£…ä¾èµ–](#å®‰è£…ä¾èµ–)
    - [â–¶ï¸å¯åŠ¨å¼€å‘ç¯å¢ƒ](#â–¶ï¸å¯åŠ¨å¼€å‘ç¯å¢ƒ)
    - [å‰åç«¯åŒæ—¶å¯åŠ¨](#å‰åç«¯åŒæ—¶å¯åŠ¨)
  - [è®¿é—®æ–¹å¼](#è®¿é—®æ–¹å¼)
  - [é¡¹ç›®ç›®å½•è¯´æ˜](#é¡¹ç›®ç›®å½•è¯´æ˜)

  ---

## ğŸ”¥é¡¹ç›®äº®ç‚¹

CollaBoard é¢å‘çš„æ˜¯å…¸å‹çš„**å¤šäººå¹¶å‘åä½œåœºæ™¯**ï¼Œé¡¹ç›®æ ¸å¿ƒä¸åœ¨äºç»˜å›¾åŠŸèƒ½æœ¬èº«ï¼Œè€Œåœ¨äºå¦‚ä½•**åœ¨é«˜é¢‘äº¤äº’ä¸‹ä¿è¯çŠ¶æ€ä¸€è‡´ã€å»¶è¿Ÿå¯æ§ä¸æ“ä½œå¯å›æº¯**ã€‚

ç³»ç»Ÿå°†æ‰€æœ‰ç”¨æˆ·è¡Œä¸ºç»Ÿä¸€å»ºæ¨¡ä¸ºä¸å¯å˜çš„ **DrawAction äº‹ä»¶æµ**ï¼Œå‰ç«¯é‡‡ç”¨ **Optimistic Rendering**ï¼ˆå…ˆæœ¬åœ°æ¸²æŸ“ï¼ŒåæœåŠ¡ç«¯ç¡®è®¤ï¼‰ï¼Œæ˜¾è‘—é™ä½äº¤äº’å»¶è¿Ÿï¼›æœåŠ¡ç«¯ç»´æŠ¤æˆ¿é—´çº§çŠ¶æ€å¹¶è¿›è¡Œ**æœ‰åºå¹¿æ’­**ï¼Œä¿è¯æ‰€æœ‰å®¢æˆ·ç«¯æœ€ç»ˆä¸€è‡´ã€‚

åœ¨åä½œå†²çªå¤„ç†ä¸Šï¼Œå¼•å…¥**åŸºäºè½¯åˆ é™¤çš„äº‹ä»¶çº§æ’¤é”€æœºåˆ¶ï¼Œå®ç°æ¯ç”¨æˆ·ç‹¬ç«‹çš„ Undo / Redo æ ˆ**ï¼ŒåŒæ—¶é¿å…ä¼ ç»Ÿå›æ»šåœ¨å¤šäººåœºæ™¯ä¸‹å¼•å‘çš„çŠ¶æ€é”™ä¹±é—®é¢˜ã€‚

æ­¤å¤–ï¼Œé¡¹ç›®é€šè¿‡**åæ ‡å½’ä¸€åŒ–**ä¸**é«˜ DPI Canvas æ¸²æŸ“é€‚é…**ï¼Œä½¿ç»˜åˆ¶ç»“æœåœ¨**ä¸åŒè®¾å¤‡ã€åˆ†è¾¨ç‡ä¸çª—å£å°ºå¯¸ä¸‹**ä¿æŒä¸€è‡´æ€§ï¼Œä½“ç°äº†å¯¹çœŸå®ä½¿ç”¨åœºæ™¯ä¸ç³»ç»Ÿå¯æ‰©å±•æ€§çš„æ·±å…¥è€ƒè™‘ã€‚

CollaBoard æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**äº‹ä»¶é©±åŠ¨çš„å®æ—¶åä½œç³»ç»ŸåŸå‹**ï¼Œè€Œä¸ä»…æ˜¯ä¸€ä¸ªåŠŸèƒ½å åŠ çš„ç™½æ¿åº”ç”¨ã€‚

---
## ğŸš€ä¸»è¦åŠŸèƒ½

* ğŸ– **è‡ªç”±ç»˜åˆ¶**ï¼šå¤šç§ç”»ç¬”ï¼ˆé“…ç¬”ã€é©¬å…‹ç¬”ã€æ¿€å…‰ç¬”ã€æ©¡çš®æ“¦ï¼‰
* ğŸ”· **å›¾å½¢ç»˜åˆ¶**ï¼šçŸ©å½¢ã€åœ†å½¢ã€ä¸‰è§’å½¢ã€å¤šè¾¹å½¢ã€ç®­å¤´ç­‰
* ğŸ”„ **æ’¤é”€ / é‡åš**ï¼šè½¯åˆ é™¤ + per-user undo æ ˆ
* ğŸ‘¥ **å®æ—¶åä½œ**ï¼šå¤šäººåŒæ—¶åœ¨çº¿ç»˜åˆ¶ä¸å…‰æ ‡åŒæ­¥
* ğŸ  **åˆ›å»º/åŠ å…¥æˆ¿é—´**ï¼šæ”¯æŒæˆ¿é—´å· + å¯†ç 
* ğŸ“¸ **å¯¼å‡º PNG**ï¼šå°†ä¸»ç”»å¸ƒå¯¼å‡ºä¸ºå›¾ç‰‡
* âš¡ **é«˜æ¸…ç”»å¸ƒæ¸²æŸ“**ï¼šæ”¯æŒé«˜ DPI ä¼˜åŒ– canvas

---

## ğŸ§ æ ¸å¿ƒåŸç†

### æ¦‚è¿°

CollaBoard ä½¿ç”¨ **React + Vite** æ„å»ºå‰ç«¯ï¼Œ**Node.js + Express + Socket.io** æ„å»ºåç«¯ï¼Œé€šè¿‡ WebSocket å®ç°å¤šäººåä½œã€‚

#### ğŸ¨å®¢æˆ·ç«¯

å¤„ç†ç”¨æˆ·äº¤äº’

Canvas æ¸²æŸ“

å…‰æ ‡ä¸æœ¬åœ°çŠ¶æ€ç®¡ç†

#### ğŸ§ æœåŠ¡ç«¯

æˆ¿é—´ç®¡ç†

çŠ¶æ€ç»´æŠ¤

æ“ä½œå¹¿æ’­ä¸åŒæ­¥

æ¯æ¬¡ç”¨æˆ·æ“ä½œéƒ½ä¼šç”Ÿæˆç»Ÿä¸€æ•°æ®ç»“æ„ `DrawAction`ï¼Œå‰ç«¯å…ˆæœ¬åœ°æ¸²æŸ“ï¼Œæ“ä½œç»“æŸåå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ›´æ–°æˆ¿é—´çŠ¶æ€å¹¶å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œå®ç°ä½å»¶è¿Ÿå®æ—¶åä½œã€‚

---

### åè®®ä¸äº‹ä»¶å®šä¹‰ï¼ˆSocketï¼‰

#### ğŸ“¨ å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯

| äº‹ä»¶å             | Payload                        | è¯´æ˜     |
| --------------- | ------------------------------ | ------ |
| `room:join`     | `{ roomId, userName }`         | åŠ å…¥æˆ¿é—´   |
| `draw:commit`   | `{ roomId, action }`           | æäº¤ç»˜åˆ¶åŠ¨ä½œ |
| `action:undo`   | `{ roomId, userId }`           | æ’¤é”€æ“ä½œ   |
| `action:redo`   | `{ roomId, userId }`           | é‡åšæ“ä½œ   |
| `cursor:update` | `{ roomId, position, pageId }` | å…‰æ ‡æ›´æ–°   |
| `board:clear`   | `{ roomId, pageId }`           | æ¸…ç©ºç”»å¸ƒ   |

#### ğŸ“¤ æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯

| äº‹ä»¶å                     | Payload                                | è¯´æ˜      |
| ----------------------- | -------------------------------------- | ------- |
| `room:joined`           | `{ roomId, self, state }`              | åŠ å…¥æˆåŠŸ    |
| `draw:created`          | `{ roomId, action }`                   | å¹¿æ’­æ–°åŠ¨ä½œ   |
| `action:updatedDeleted` | `{ roomId, actionId, isDeleted }`      | æ’¤é”€/æ¢å¤æ›´æ–° |
| `cursor:updated`        | `{ roomId, userId, position, pageId }` | å…‰æ ‡æ›´æ–°    |
| `board:cleared`         | `{ roomId, pageId }`                   | æ¸…å±å¹¿æ’­    |
| `room:state-sync`       | `{ roomId, state }`                    | å…¨é‡åŒæ­¥    |

---

### ğŸ’¡å¼€å‘æç¤º

ğŸ“ åæ ‡ç»Ÿä¸€ å½’ä¸€åŒ– (0 ~ 1)ï¼Œè‡ªåŠ¨é€‚é…ä¸åŒå±å¹•

ğŸ§¹ æ’¤é”€ä½¿ç”¨ è½¯åˆ é™¤ (isDeleted)ï¼Œé¿å…å¹¶å‘å†²çª

ğŸ¢ å…‰æ ‡æ›´æ–°åš 50ms èŠ‚æµï¼Œæ€§èƒ½æ›´ç¨³

ğŸ” é«˜ DPI è®¾å¤‡éœ€ ctx.scale(dpr, dpr)

---

## âš¡å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm run install:all
```

æˆ–æ‰‹åŠ¨ï¼š

```bash
cd client
npm install
cd ../server
npm install
```

---

### â–¶ï¸å¯åŠ¨å¼€å‘ç¯å¢ƒ

**å‰ç«¯ï¼ˆClientï¼‰**ï¼š

```bash
cd client
npm run dev
```

ç»ˆç«¯æ˜¾ç¤ºï¼š

```
âœ  Local:   http://localhost:5173/
âœ  Network: http://<ä½ çš„å±€åŸŸç½‘IP>:5173/
```

**åç«¯ï¼ˆServerï¼‰**ï¼š

```bash
cd server
npm run dev
```

ç»ˆç«¯æ˜¾ç¤ºï¼š

```
ğŸš€ åç«¯æœåŠ¡å·²å¯åŠ¨!
---------------------------
æœ¬æœºç‹¬äº«: http://localhost:3000
å¤šäººè”æœº: http://<ä½ çš„å±€åŸŸç½‘IP>:3000 
---------------------------
```

---

### å‰åç«¯åŒæ—¶å¯åŠ¨

å®‰è£… concurrentlyï¼š

```bash
npm install -D concurrently
```

æ ¹ç›®å½• `package.json` æ·»åŠ ï¼š

```json
"scripts": {
  "dev:client": "cd client && npm run dev",
  "dev:server": "cd server && npm run dev",
  "start": "concurrently \"npm:dev:server\" \"npm:dev:client\""
}
```

è¿è¡Œï¼š

```bash
npm run start
```

---

## è®¿é—®æ–¹å¼

* **æœ¬åœ°è®¿é—®**ï¼š`http://localhost:5173/` (å‰ç«¯) / `http://localhost:3000` (åç«¯)
* **å±€åŸŸç½‘è®¿é—®**ï¼šç»ˆç«¯æ˜¾ç¤ºçš„ `Network` åœ°å€ï¼Œä¾‹å¦‚ `http://10.136.85.139:5173/` / `http://10.136.85.139:3000`

---

## é¡¹ç›®ç›®å½•è¯´æ˜

```
/
â”œâ”€â”€ client/                  # å‰ç«¯ React + Vite
   |â€”â€” public/               # ä¸€äº›å›¾ç‰‡èµ„æº
   |â€”â€” src        
       |â€”â€” assets 
       |â€”â€” components     
           |â€”â€” CanvasLayer       # å®Œæˆç™½æ¿é¡µé¢çš„ç”»ç”»ã€é€‰ä¸­ã€æ‹–æ‹½ã€é¢„è§ˆã€åŒæ­¥ã€åŠ¨ç”»æ“ä½œ
           |â€”â€” Toolbar           # å·¦ä¾§å·¥å…·æ ç»„ä»¶çš„çŠ¶æ€åˆ‡æ¢å™¨ä½œç”¨åŠå…¶UI
       |â€”â€” hooks             
           |â€”â€” useCanvasScaling  # è‡ªåŠ¨å¤„ç† Canvas çš„ DPR å’Œçª—å£å¤§å°å˜åŒ–
       |â€”â€” pages
           |â€”â€” BoardPage         # ç™½æ¿é¡µé¢çº§åˆ«çš„æ§åˆ¶å™¨
           |â€”â€” LoginPage         # ç™»é™†é¡µé¢æ§åˆ¶å™¨   
       |â€”â€” services
           |â€”â€” socket            # socketç½‘ç»œç®¡ç†å™¨ï¼Œè´Ÿè´£ç™½æ¿å’ŒæœåŠ¡å™¨çš„æ‰€æœ‰å®æ—¶é€šä¿¡
       |â€”â€” shared
           |â€”â€” protocol          # typescriptåè®®æ–‡ä»¶ï¼Œæ•´ä¸ªç™½æ¿å‰åç«¯é€šä¿¡çš„æ•°æ®ç±»å‹å’Œäº‹ä»¶å®šä¹‰
       |â€”â€” utils
           |â€”â€” id                # å‰ç«¯ç”Ÿæˆå”¯ä¸€ ID çš„å·¥å…·å‡½æ•°
           |â€”â€” math              # ç»˜å›¾çš„å‡ ä½•è®¡ç®—å·¥å…·
           |â€”â€” render            # Canvasæ¸²æŸ“æ¨¡å—
       |â€”â€” App.css               # æ ·å¼æ¸²æŸ“
       |â€”â€” App.tsx               # Reactåº”ç”¨å…¥å£ï¼Œæ•´åˆå‰ç«¯è·¯ç”±å’Œå®æ—¶è¿æ¥
       |â€”â€” index.css             # Tailwind CSSçš„å…¨å±€æ ·å¼
       |â€”â€”main.tsx               # React 18 å…¥å£æ–‡ä»¶
    |â€”â€” eslint.config.js         # ä¸ºTS+React+Viteæä¾›å®Œæ•´lintæ£€æŸ¥
    |â€”â€” index.html               # å‰ç«¯åº”ç”¨HTMLæ¨¡æ¿
    |â€”â€” package
    |â€”â€”postcss.config.js         # PostCSSé…ç½®æ–‡ä»¶
    |â€”â€” tailwind.config.js
    |â€”â€” tsconfig.app.json        # TypeScripté…ç½®æ–‡ä»¶
    |â€”â€” tsconfig.json            # TypeScript çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œå¼•ç”¨äº†åº”ç”¨å’Œ Node.js ç›¸å…³çš„é…ç½®æ–‡ä»¶
    |â€”â€” tsconfig.node.json       # ä¸“é—¨é’ˆå¯¹ Vite é…ç½®æ–‡ä»¶çš„ TypeScript æ£€æŸ¥è®¾ç½®
    |â€”â€” vite.config.ts           # Viteé…ç½®æ–‡ä»¶
|â€”â€” server/                      # åç«¯ Express + Socket.io
    |â€”â€” src
        |â€”â€” shared                   
            |â€”â€” protocol         # åç«¯typescriptåè®®æ–‡ä»¶
        |â€”â€” index                # åä½œç™½æ¿åç«¯
        |â€”â€” package-lock
        |â€”â€” package
        |â€”â€” tsconfig 
|â€”â€” gitignore                
|â€”â€” README.md
|â€”â€” SDD.md                        # è½¯ä»¶è®¾è®¡è¯´æ˜ä¹¦

---