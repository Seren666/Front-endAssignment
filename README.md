```markdown
# CollaBoard â€” å¤šäººå®æ—¶åä½œç™½æ¿

> ä¸€ä¸ªå¤šäººå®æ—¶åä½œç™½æ¿åº”ç”¨ï¼Œæ”¯æŒè‡ªç”±ç»˜åˆ¶ã€å›¾å½¢ç»˜åˆ¶ã€æ’¤é”€/é‡åšã€å¤šäººå…‰æ ‡å’Œå¯¼å‡ºå›¾ç‰‡ç­‰åŠŸèƒ½ã€‚

CollaBoard é‡‡ç”¨ React + Vite ä½œä¸ºå‰ç«¯æ¡†æ¶ï¼ŒNode.js + Express + Socket.io ä½œä¸ºåç«¯æœåŠ¡ï¼Œé€šè¿‡ WebSocket å®ç°å¤šäººåä½œã€‚æ¯ä¸ªç”¨æˆ·çš„ç»˜å›¾æ“ä½œè¢«å°è£…ä¸º `DrawAction` å¹¶å¹¿æ’­è‡³æˆ¿é—´ä¸­çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œä¿è¯ä¸åŒå®¢æˆ·ç«¯çš„çŠ¶æ€ä¸€è‡´ã€‚

---

## ğŸ“Œ åŠŸèƒ½ç‰¹æ€§

### ğŸ–Œï¸ ä¸»è¦åŠŸèƒ½

- ğŸ– **è‡ªç”±ç»˜åˆ¶**ï¼šæ”¯æŒå¤šç§ç”»ç¬”ï¼ˆé“…ç¬”ã€é©¬å…‹ç¬”ã€æ¿€å…‰ç¬”ã€æ©¡çš®æ“¦ï¼‰
- ğŸ”· **å›¾å½¢ç»˜åˆ¶**ï¼šçŸ©å½¢ã€åœ†å½¢ã€ä¸‰è§’å½¢ã€å¤šè¾¹å½¢ã€ç®­å¤´ç­‰å‡ ä½•å›¾å½¢
- ğŸ”„ **æ’¤é”€ / é‡åš**ï¼šåŸºäºè½¯åˆ é™¤å’Œ per-user undo æ ˆ
- ğŸ‘¥ **å®æ—¶åä½œ**ï¼šå¤šäººåŒæ—¶åœ¨çº¿ç»˜åˆ¶ä¸å…‰æ ‡åŒæ­¥
- ğŸ¯ **å…‰æ ‡åŒæ­¥**ï¼šå®æ—¶æ˜¾ç¤ºå…¶ä»–ç”¨æˆ·çš„å…‰æ ‡ä½ç½®
- ğŸ“¸ **å¯¼å‡º PNG**ï¼šå°†ä¸»ç”»å¸ƒå†…å®¹å¯¼å‡ºä¸ºå›¾ç‰‡
- âš™ï¸ **é«˜æ¸…ç”»å¸ƒæ¸²æŸ“**ï¼šæ”¯æŒé«˜ DPI è®¾å¤‡ä¼˜åŒ– canvas æ˜¾ç¤º

---

## ğŸ§  æ ¸å¿ƒåŸç†ç®€è¿°

### ğŸ§© å®æ—¶åä½œæ¶æ„

æ•´ä¸ªç³»ç»Ÿé‡‡ç”¨ **Clientâ€“Server + WebSocket** æ¨¡å¼ï¼š

```

æµè§ˆå™¨ Client âŸ· Socket.io âŸ· Node æœåŠ¡ç«¯
React + Canvas â†â†’ Express + Socket.io

````

å‰ç«¯è´Ÿè´£è·å–ç”¨æˆ·è¾“å…¥ï¼Œåœ¨æœ¬åœ°æ¸²æŸ“é¢„è§ˆå¹¶æ„é€ ç»˜åˆ¶åŠ¨ä½œï¼ˆ`DrawAction`ï¼‰ï¼Œåœ¨ `pointerup` æ—¶å‘é€ç»™åç«¯ã€‚  
åç«¯ç»´æŠ¤æˆ¿é—´çŠ¶æ€ï¼Œå¹¶å¹¿æ’­ç»™æˆ¿é—´å†…æ‰€æœ‰å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ ¹æ®æ”¶åˆ°çš„åŠ¨ä½œæ›´æ–°æœ¬åœ°çŠ¶æ€å¹¶é‡ç»˜ç”»å¸ƒï¼Œä»è€Œä¿è¯æ¯ä¸ªäººçœ‹åˆ°çš„å†…å®¹ä¸€è‡´ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ› ï¸ å®‰è£…ä¾èµ–

åœ¨æ ¹ç›®å½•è¿è¡Œï¼š

```bash
npm run install:all
````

æˆ–æ‰‹åŠ¨å®‰è£…ï¼š

```bash
cd client
npm install

cd ../server
npm install
```

---

### ğŸ‘©â€ğŸ’» å¯åŠ¨å¼€å‘ç¯å¢ƒ

**å‰ç«¯ï¼ˆClientï¼‰ï¼š**

```bash
cd client
npm run dev
```

é»˜è®¤ï¼š[http://localhost:5173](http://localhost:5173)

**åç«¯ï¼ˆServerï¼‰ï¼š**

```bash
cd server
npm run dev
```

é»˜è®¤ï¼š[http://localhost:3000](http://localhost:3000)

---

### ğŸ§ª ä¸¤ç«¯ä¸€èµ·è·‘ï¼ˆæ¨èï¼‰

å®‰è£… concurrentlyï¼š

```bash
npm install -D concurrently
```

æ ¹ç›®å½• `package.json` æ·»åŠ ï¼š

```json
"scripts": {
  "dev:client": "cd client && npm run dev",
  "dev:server": "cd server && npm run dev",
  "start": "concurrently \"npm:dev:server\" \"npm:dev:client\""
}
```

ç„¶åè¿è¡Œï¼š

```bash
npm run start
```

---

## ğŸ—‚ï¸ åè®®ä¸äº‹ä»¶å®šä¹‰ï¼ˆSocketï¼‰

### ğŸ“¨ å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯

| äº‹ä»¶å             | Payload                        | è¯´æ˜     |
| --------------- | ------------------------------ | ------ |
| `room:join`     | `{ roomId, userName }`         | åŠ å…¥æˆ¿é—´   |
| `draw:commit`   | `{ roomId, action }`           | æäº¤ç»˜åˆ¶åŠ¨ä½œ |
| `action:undo`   | `{ roomId, userId }`           | æ’¤é”€æ“ä½œ   |
| `action:redo`   | `{ roomId, userId }`           | é‡åšæ“ä½œ   |
| `cursor:update` | `{ roomId, position, pageId }` | å…‰æ ‡æ›´æ–°   |
| `board:clear`   | `{ roomId, pageId }`           | æ¸…ç©ºç”»å¸ƒ   |

### ğŸ“¤ æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯

| äº‹ä»¶å                     | Payload                                | è¯´æ˜      |
| ----------------------- | -------------------------------------- | ------- |
| `room:joined`           | `{ roomId, self, state }`              | åŠ å…¥æˆåŠŸ    |
| `draw:created`          | `{ roomId, action }`                   | å¹¿æ’­æ–°åŠ¨ä½œ   |
| `action:updatedDeleted` | `{ roomId, actionId, isDeleted }`      | æ’¤é”€/æ¢å¤æ›´æ–° |
| `cursor:updated`        | `{ roomId, userId, position, pageId }` | å…‰æ ‡æ›´æ–°    |
| `board:cleared`         | `{ roomId, pageId }`                   | æ¸…å±å¹¿æ’­    |
| `room:state-sync`       | `{ roomId, state }`                    | å…¨é‡åŒæ­¥    |

---

## ğŸ§  å¼€å‘æç¤º

* æ‰€æœ‰åŠ¨ä½œä½¿ç”¨ **å½’ä¸€åŒ–åæ ‡ï¼ˆ0~1ï¼‰**ï¼Œä¸åŒå±å¹•å°ºå¯¸ä¿æŒä¸€è‡´
* æ’¤é”€ç”¨è½¯åˆ é™¤ï¼ˆ`isDeleted`ï¼‰ï¼Œå‡å°‘å†²çª
* å…‰æ ‡æ›´æ–°å»ºè®® **èŠ‚æµ 50ms**
* canvas åœ¨é«˜ DPI å±å¹•ä¸‹éœ€è¦å¤„ç† `devicePixelRatio` å¹¶ç”¨ `ctx.scale(dpr, dpr)` é¿å…æ¨¡ç³Š

---

## ğŸ“¦ ç›®å½•è¯´æ˜

```
/
â”œâ”€â”€ client/       # å‰ç«¯ React + Vite
â”œâ”€â”€ server/       # åç«¯ Express + Socket.io
â”œâ”€â”€ README.md
```